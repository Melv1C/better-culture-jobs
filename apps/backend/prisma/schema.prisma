generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Log {
  id Int @id @default(autoincrement())

  // Common fields
  type     LogType
  level    String
  message  String
  metadata Json?

  // RequestLog-specific fields
  userId     String?
  method     String?
  path       String?
  statusCode Int?
  durationMs Int?
  steps      Json?

  createdAt DateTime @default(now())

  @@index([type])
  @@index([level])
  @@index([userId])
  @@index([createdAt])
  @@map("log")
}

enum LogType {
  APP
  REQUEST
}

model Job {
  id Int @id @default(autoincrement())

  uid    Int
  source JobSource @default(CULTURE_BE)

  sourceUrl  String
  listingUrl String

  title        String
  organization String

  publicationDate    DateTime
  publicationDateRaw String
  postingType        JobPostingType

  contractTypes ContractType[] @default([])
  contractLabel String?
  location      String?

  applicationDeadline    DateTime?
  applicationDeadlineRaw String?

  jobDescription          String?
  requirements            String?
  contractDetails         String?
  regime                  String?
  applicationInstructions String?
  documentsRequired       String?
  comments                String?

  employerDescription String?
  employerSectors     String?
  contactDetails      String?
  moreInfo            String?

  rawDetails Json?

  scrapedAt   DateTime @default(now())
  lastUpdated DateTime @updatedAt

  @@unique([source, uid])
  @@index([source, publicationDate])
  @@index([postingType])
  @@index([applicationDeadline])
  @@map("job")
}

enum JobSource {
  CULTURE_BE
}

enum JobPostingType {
  EMPLOI
  STAGE
  BENEVOLAT
  AUTRE
}

enum ContractType {
  CDD
  CDI
  AUTRE
}

model JobSyncState {
  source JobSource @id

  lastSyncedAt DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("job_sync_state")
}

model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  sessions      Session[]
  accounts      Account[]

  role       String?
  banned     Boolean?  @default(false)
  banReason  String?
  banExpires DateTime?

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  impersonatedBy String?

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}
